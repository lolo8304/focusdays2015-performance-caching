<html>

<script type="text/javascript" src="jquery-1.11.3/jquery-1.11.3.min.js"></script>

<script>

$(document).ready(function() {

    $(document).on('keypress', '#searchBox', function(e) {

        if ( e.keyCode == 13 ) {  // detect the enter key
        	console.log("changed "+ $('#searchBox').val());
        	loadContent($('#searchBox').val());
        }
    });



 function loadContent(search) {
	// load any data
	console.log("search..."+search);
	var timeStart = (new Date()).getMilliseconds();
	var strategy = "no-cache";


	
	$.ajax({
//		url: "http://localhost/node/products/10/strategy/"+strategy,
		url: "http://localhost/table.html",
		type: "GET",
		success: function(result){
			console.log(" sucess ");
            // messure time
            var timeEnd = (new Date()).getMilliseconds();
            var responseTime = timeEnd - timeStart;
            console.log("done: " +timeEnd +" - "+timeStart+" = " + responseTime +" ms");
			 // store time in mongoDB
            var tupple = {
                    strategy: strategy,
                    time: responseTime
            }
            send(tupple);

		}
	}).fail(function( msg ) {
		console.log("failed to get content "+JSON.stringify(msg));  //+JSON.stringify(data));
	});

	
	
}

// send the given objet to the  restserver -> MongoDB
function send(object) {
	console.log(" tuple commited ");
	$.ajax({
		url: "http://localhost/node/product",
		type: "POST",
		success: function(result){
			console.log(" tuple commitd sucessfully  "+JSON.stringify( object ));
		},
		data: JSON.stringify( object ),
		contentType: "application/json"
	}).fail(function( msg ) {
		console.log("failed to commit tupple "+JSON.stringify(msg)); 
	});
	}
});

</script>
<body>
	<h1>focusday 2015 - search</h1>
	Enter text and hit enter:
	<form  rel="myMethod()">
	  <input type='text' id="searchBox" />
	    <p></p>
	<div id="result"></div>
	<h5>sample taken from <a target="_blank" href="http://stackoverflow.com/questions/29907075/populate-table-from-json-with-search">stackoverflow</a></h5>
</form>
</body>
</html>